"use strict";(()=>{var r="stc-cache-v1",l="/offline.html",h=[l,"/manifest.json","/favicon.ico","/icons/icon-192x192.png","/icons/icon-512x512.png"],i=self;i.addEventListener("install",e=>{let s=async()=>{try{console.log("[SW] Installing..."),await(await caches.open(r)).addAll(h),console.log("[SW] Installed")}catch(c){console.error("[SW] Install failed:",c)}};e.waitUntil(s()),i.skipWaiting()});i.addEventListener("activate",e=>{let s=async()=>{try{console.log("[SW] Activating...");let c=await caches.keys();await Promise.all(c.map(t=>{if(t!==r)return console.log("[SW] Removing old cache:",t),caches.delete(t)})),await i.clients.claim(),console.log("[SW] Activated")}catch(c){console.error("[SW] Activate failed:",c)}};e.waitUntil(s())});i.addEventListener("fetch",e=>{if(e.request.method!=="GET")return;let s=async()=>{try{if(e.request.mode==="navigate")try{return await fetch(e.request)}catch(n){console.error("[SW] Navigation fetch failed, falling back to offline page",n);let o=await(await caches.open(r)).match(l);if(o)return o;throw n}let c=await caches.match(e.request);if(c){let n=async()=>{try{let a=await fetch(e.request);if(a&&a.status===200){let o=a.clone();await(await caches.open(r)).put(e.request,o)}}catch(a){console.error("[SW] Background cache update failed:",a)}};return e.waitUntil(n()),c}let t=await fetch(e.request);if(t&&t.status===200&&t.type==="basic"){let n=t.clone(),a=async()=>{try{await(await caches.open(r)).put(e.request,n)}catch(o){console.error("[SW] Cache put failed:",o)}};e.waitUntil(a())}return t}catch(c){throw console.error("[SW] Fetch failed:",c),(e.request.headers.get("accept")||"").includes("image"),c}};e.respondWith(s())});})();
