"use strict";(()=>{var o="stc-cache-v1",i="/offline.html",l=[i,"/manifest.json","/favicon.ico","/icons/icon-192x192.png","/icons/icon-512x512.png"],s=self;s.addEventListener("install",e=>{let a=async()=>{try{console.log("[SW] Installing..."),await(await caches.open(o)).addAll(l),console.log("[SW] Installed"),s.skipWaiting()}catch(t){throw console.error("[SW] Install failed:",t),t}};e.waitUntil(a())});s.addEventListener("activate",e=>{let a=async()=>{try{console.log("[SW] Activating...");let t=await caches.keys();await Promise.all(t.map(c=>{if(c!==o)return console.log("[SW] Removing old cache:",c),caches.delete(c)})),await s.clients.claim(),console.log("[SW] Activated")}catch(t){console.error("[SW] Activate failed:",t)}};e.waitUntil(a())});async function h(e){try{return await fetch(e)}catch(a){console.error("[SW] Navigation fetch failed, falling back to offline page",a);let c=await(await caches.open(o)).match(i);if(c)return c;throw a}}async function d(e,a,t){try{let c=async()=>{try{let n=await fetch(e);if(n&&n.status===200){let r=n.clone();await(await caches.open(o)).put(e,r)}}catch(n){console.error("[SW] Background cache update failed:",n)}};t.waitUntil(c())}catch(c){console.error("[SW] handleCachedAsset failed:",c)}return a}async function f(e,a,t){try{let c=a.clone(),n=async()=>{try{await(await caches.open(o)).put(e,c)}catch(r){console.error("[SW] Cache put failed:",r)}};t.waitUntil(n())}catch(c){console.error("[SW] cacheResponse failed:",c)}}s.addEventListener("fetch",e=>{if(e.request.method!=="GET")return;let a=async()=>{try{if(e.request.mode==="navigate")return await h(e.request);let t=await caches.match(e.request);if(t)return await d(e.request,t,e);let c=await fetch(e.request);return c&&c.status===200&&c.type==="basic"&&await f(e.request,c,e),c}catch(t){throw console.error("[SW] Fetch failed:",t),(e.request.headers.get("accept")||"").includes("image"),t}};e.respondWith(a())});})();
