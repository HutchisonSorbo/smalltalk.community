"use strict";(()=>{var o="stc-cache-v1",r="/offline.html",l=[r,"/manifest.json","/favicon.ico","/icons/icon-192x192.png","/icons/icon-512x512.png"],s=self;s.addEventListener("install",e=>{let t=async()=>{try{console.log("[SW] Installing..."),await(await caches.open(o)).addAll(l),console.log("[SW] Installed"),s.skipWaiting()}catch(c){throw console.error("[SW] Install failed:",c),c}};e.waitUntil(t())});s.addEventListener("activate",e=>{let t=async()=>{try{console.log("[SW] Activating...");let c=await caches.keys();await Promise.all(c.map(a=>{if(a!==o)return console.log("[SW] Removing old cache:",a),caches.delete(a)})),await s.clients.claim(),console.log("[SW] Activated")}catch(c){console.error("[SW] Activate failed:",c)}};e.waitUntil(t())});async function h(e){try{return await fetch(e)}catch(t){console.error("[SW] Navigation fetch failed, falling back to offline page",t);let a=await(await caches.open(o)).match(r);if(a)return a;throw t}}async function d(e,t,c){let a=async()=>{try{let n=await fetch(e);if(n&&n.status===200){let i=n.clone();await(await caches.open(o)).put(e,i)}}catch(n){console.error("[SW] Background cache update failed:",n)}};return c.waitUntil(a()),t}async function f(e,t,c){if(t&&t.status===200&&t.type==="basic"){let a=t.clone(),n=async()=>{try{await(await caches.open(o)).put(e,a)}catch(i){console.error("[SW] Cache put failed:",i)}};c.waitUntil(n())}}s.addEventListener("fetch",e=>{if(e.request.method!=="GET")return;let t=async()=>{try{if(e.request.mode==="navigate")return await h(e.request);let c=await caches.match(e.request);if(c)return await d(e.request,c,e);let a=await fetch(e.request);return await f(e.request,a,e),a}catch(c){throw console.error("[SW] Fetch failed:",c),(e.request.headers.get("accept")||"").includes("image"),c}};e.respondWith(t())});})();
