# Daily Security & Compliance Audit Report
**Date:** 2026-01-28
**Time:** 6:00 AM AEST
**Commit:** [Current HEAD]

## Executive Summary
**Status:** üü° WARNINGS

**Issues Found:**
- Critical (P1): 1
- High (P2): 1
- Medium (P3): 1
- Low (P4): 0

**Compliance:**
- Child Safe Standards: ‚ùå (Fixed in PR)
- Privacy Act: ‚úÖ (with improvements)
- WCAG 2.2 AA: ‚úÖ (Assumed based on existing checks)
- Security: ‚úÖ (after fixes)

---

## üö® Critical Issues (P1)

### Age Verification Bypass
**Category:** Child Safety
**Location:** `app/api/onboarding/profile/route.ts:81`
**CVE:** N/A

**Description:**
The profile setup endpoint allowed users to bypass age verification if they registered via OAuth (which skips the initial registration form) and did not provide a Date of Birth in the profile setup payload. The system assumed `dateOfBirth` would be provided or already exist, but the validation logic was conditional on the field's presence.

**Risk:**
Minors under 13 could access the platform, or minors 13-17 could bypass age-appropriate privacy defaults (e.g., private profile) by not providing their age. This is a severe violation of Victorian Child Safe Standards.

**Current Code:**
```typescript
// 3.1 Handle Date of Birth / Age Verification for OAuth users
let userUpdates: any = {};

if (profileData.dateOfBirth) {
    // ... checks age ...
}
```

**Fix:**
```typescript
// Critical: Ensure Date of Birth is provided if not already on record (e.g. OAuth users)
if (!userRec.dateOfBirth && !profileData.dateOfBirth) {
    return NextResponse.json({
        error: "Date of birth is required for account setup"
    }, { status: 400 });
}
```

**Status:** FIXED in this PR.

---

## ‚ö†Ô∏è High Priority (P2)

### `tar` Arbitrary File Overwrite
**Category:** Security
**Location:** `node_modules/tar`
**CVE:** N/A (GHSA-34x7-hfp2-rc4v / GHSA-r6q2-hw4h-h46w)

**Description:**
The `tar` package (dependency of `supabase`) had a high-severity vulnerability allowing arbitrary file creation/overwrite via hardlink path traversal or race conditions.

**Risk:**
Potential for Denial of Service or arbitrary code execution if malicious tar archives are processed.

**Fix:**
Ran `npm audit fix`. Updated `tar` to version `7.5.7`.

**Status:** FIXED in this PR.

---

## ‚ö° Medium Priority (P3)

### Organisation Members Privacy
**Category:** Privacy
**Location:** `shared/schema.ts`

**Description:**
The Row Level Security (RLS) policy for `organisation_members` allowed ANY authenticated user to list all members of ANY organisation.

**Risk:**
Privacy leakage. Members of sensitive organisations (e.g., support groups) could be enumerated by non-members.

**Fix:**
Updated RLS policy `org_members_read` to only allow members of the organisation to view the member list.

**Status:** FIXED in this PR.

---

## Compliance Details

### Child Safe Standards
- **Age Verification:** Strengthened logic to ensure mandatory DOB collection.
- **Privacy:** Default settings for minors remain strict (verified).

### Privacy Act
- **Data Minimisation:** Checked.
- **Access Control:** Improved via RLS updates.

### Accessibility
- **WCAG 2.2:** Existing axe-core checks in CI/CD pipeline. No new regressions introduced.

---

## Security Metrics

**Vulnerabilities:**
- Critical: 0 (after fix)
- High: 0 (after fix)
- Medium: 5 (esbuild dev-only, acceptable)

**Dependencies:**
- Total Audited: ~1340
- Vulnerable: 0 (Production)

---

## Recommendations

**Immediate (24h):**

1.  Deploy this PR to production.

**Short-term (1 week):**

1.  Review CSP headers to replace `'unsafe-inline'` with nonces for stricter XSS protection.

**Long-term (1 month):**

1.  Implement automated regression testing for RLS policies.