# Daily Security & Compliance Audit Report
**Date:** 2026-01-27
**Time:** 6:00 AM AEST
**Commit:** [Current HEAD]

## Executive Summary
**Status:** ğŸŸ¡ WARNINGS

**Issues Found:**
- Critical (P1): 0
- High (P2): 2
- Medium (P3): 2
- Low (P4): 1

**Compliance:**
- Child Safe Standards: ğŸŸ¡ (Privacy defaults issue)
- Privacy Act: âœ…
- WCAG 2.2 AA: âœ… (Automated checks passing, manual review ongoing)
- Security: ğŸŸ¡ (CSP weakness)

---

## ğŸš¨ Critical Issues (P1)
*None found during this scan.*

---

## âš ï¸ High Priority (P2)

### Child Safety: Default Privacy Settings for Minors
**Category:** Child Safety
**Location:** `app/api/onboarding/profile/route.ts` / `server/storage.ts`
**CVE:** N/A

**Description:**
While age verification exists (blocking <13), users identified as minors (13-17) are not automatically assigned "private" profile visibility in the `userPrivacySettings` table. This relies on the default "community_members" setting, which may be too broad. Furthermore, the `server/storage.ts` data access layer does not enforce privacy visibility checks when fetching musician or professional profiles, potentially exposing minors or private profiles via public APIs.

**Risk:**
Minors' profiles could be visible to the public or wider community contrary to the "private by default" requirement.

**Corrective Action:**
1.  Update onboarding to explicitly set `profileVisibility: 'private'` for minors.
2.  Update storage queries to filter out private profiles and suspended users.

### Dependency Vulnerability: tar
**Category:** Security
**Location:** `package-lock.json`
**CVE:** GHSA-r6q2-hw4h-h46w (High)

**Description:**
The `tar` package (via `supabase` CLI dev dependency) has a high-severity vulnerability related to path reservations on macOS.

**Risk:**
Low in production (dev dependency), but potential risk during development/build processes.

**Corrective Action:**
Run `npm audit fix` or update `supabase` CLI. (Not addressed in this PR as it requires potential breaking changes to dev tools, flagged for follow-up).

---

## âš¡ Medium Priority (P3)

### CSP: unsafe-inline
**Category:** Security
**Location:** `next.config.mjs`
**CVE:** N/A

**Description:**
The Content Security Policy (CSP) includes `'unsafe-inline'` for scripts and styles. This weakens protection against XSS.

**Risk:**
Increased attack surface for XSS.

**Corrective Action:**
Migrate to Nonce-based CSP. (Flagged for future architectural improvement).

### Dependency: esbuild
**Category:** Security
**Location:** `package-lock.json`
**CVE:** GHSA-67mh-4wv8-2f99 (Moderate)

**Description:**
`esbuild` vulnerability.

**Risk:**
Development server exposure.

---

## Compliance Details

### Child Safe Standards
- **Age Verification:** âœ… Implemented (13+ check).
- **Privacy Defaults:** âš ï¸ Needs strengthening (Fix included in this PR).
- **Reporting:** âœ… `reports` table and API exist.

### Privacy Act
- **Data Minimization:** âœ…
- **User Rights:** âœ…

### Accessibility
- **Automated Checks:** âœ…

---

## Security Metrics

**Vulnerabilities:**
- Critical: 0
- High: 1 (Dev)
- Medium: 1 (Dev)

**Dependencies:**
- Next.js: 16.1.5 (Secure)
- React: 19.2.4 (Secure)

---

## Recommendations

**Immediate (24h):**
1.  Apply privacy filters to storage layer.
2.  Enforce private defaults for minors.

**Short-term (1 week):**
1.  Update `supabase` CLI to resolve `tar` vulnerability.
2.  Investigate Nonce-based CSP.
