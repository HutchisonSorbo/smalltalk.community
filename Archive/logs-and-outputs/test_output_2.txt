
> smalltalk.community@1.0.0 test
> vitest run --coverage


[1m[46m RUN [49m[22m [36mv4.0.16 [39m[90m/home/ryan/Documents/Projects/smalltalk.community[39m
      [2mCoverage enabled with [22m[33mistanbul[39m

 [32m‚úì[39m tests/unit/validation.test.ts [2m([22m[2m13 tests[22m[2m)[22m[32m 98[2mms[22m[39m
 [32m‚úì[39m tests/unit/utils/au-validation.test.ts [2m([22m[2m8 tests[22m[2m)[22m[32m 116[2mms[22m[39m
 [32m‚úì[39m tests/unit/utils.test.ts [2m([22m[2m4 tests[22m[2m)[22m[32m 42[2mms[22m[39m
 [32m‚úì[39m tests/unit/age-utils.test.ts [2m([22m[2m9 tests[22m[2m)[22m[32m 20[2mms[22m[39m
 [32m‚úì[39m tests/unit/onboarding-schemas.test.ts [2m([22m[2m20 tests[22m[2m)[22m[32m 106[2mms[22m[39m
 [32m‚úì[39m tests/integration/features/CommunicationLog.test.tsx [2m([22m[2m3 tests[22m[2m)[22m[33m 662[2mms[22m[39m
     [33m[2m‚úì[22m[39m renders logs correctly [33m 541[2mms[22m[39m
 [32m‚úì[39m tests/unit/lib/dittoSync.test.ts [2m([22m[2m8 tests[22m[2m)[22m[32m 93[2mms[22m[39m
 [32m‚úì[39m tests/unit/models/engagement.test.ts [2m([22m[2m8 tests[22m[2m)[22m[32m 23[2mms[22m[39m
 [32m‚úì[39m tests/unit/rate-limiter.test.ts [2m([22m[2m17 tests[22m[2m)[22m[32m 99[2mms[22m[39m
[90mstdout[2m | tests/integration/features/referral-bridge.test.ts[2m > [22m[2mService Referral Bridge[2m > [22m[2msuccessfully bridges public referral to internal tenant storage
[22m[39m[IntegrationBridge] Bridged referral for Test Member to tenant tenant-123

 [32m‚úì[39m tests/integration/features/referral-bridge.test.ts [2m([22m[2m1 test[22m[2m)[22m[32m 59[2mms[22m[39m
 [32m‚úì[39m tests/unit/utils/age-cohort.test.ts [2m([22m[2m6 tests[22m[2m)[22m[32m 22[2mms[22m[39m
 [31m‚ùØ[39m tests/integration/components/member-form.test.tsx [2m([22m[2m2 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 3942[2mms[22m[39m
     [33m[2m‚úì[22m[39m validates required fields before submission [33m 1223[2mms[22m[39m
[31m     [31m√ó[31m submits correctly with valid data[39m[33m 2708[2mms[22m[39m
 [32m‚úì[39m tests/unit/utils/privacy.test.ts [2m([22m[2m7 tests[22m[2m)[22m[32m 12[2mms[22m[39m
 [32m‚úì[39m tests/unit/lib/tenant.test.ts [2m([22m[2m2 tests[22m[2m)[22m[32m 21[2mms[22m[39m
[90mstdout[2m | tests/unit/performance.test.ts[2m > [22m[2mPerformance Critical Paths[2m > [22m[2mgetAverageRating[2m > [22m[2mshould use caching to reduce DB hits
[22m[39mgetAverageRating latency (2 calls, 1 cached): 1.3580379999993966ms

 [32m‚úì[39m tests/unit/performance.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 13[2mms[22m[39m

[31m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[39m[1m[41m Failed Tests 1 [49m[22m[31m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[39m

[41m[1m FAIL [22m[49m tests/integration/components/member-form.test.tsx[2m > [22mMemberForm Integration[2m > [22msubmits correctly with valid data
[31m[1mAssertionError[22m[39m: expected "vi.fn()" to be called with arguments: [ { firstName: 'John', ‚Ä¶(2) } ][90m

Received: 

[1m  1st vi.fn() call:

[22m[33m@@ -2,6 +2,90 @@[90m
[2m    {[22m
[2m      "email": "john@example.com",[22m
[2m      "firstName": "John",[22m
[2m      "lastName": "Doe",[22m
[2m    },[22m
[31m+   SyntheticBaseEvent {[90m
[31m+     "_reactName": "onSubmit",[90m
[31m+     "_targetInst": null,[90m
[31m+     "bubbles": true,[90m
[31m+     "cancelable": true,[90m
[31m+     "currentTarget": null,[90m
[31m+     "defaultPrevented": true,[90m
[31m+     "eventPhase": 3,[90m
[31m+     "isDefaultPrevented": [Function functionThatReturnsTrue],[90m
[31m+     "isPropagationStopped": [Function functionThatReturnsFalse],[90m
[31m+     "isTrusted": true,[90m
[31m+     "nativeEvent": SubmitEvent {[90m
[31m+       "isTrusted": true,[90m
[31m+     },[90m
[31m+     "target": <form[90m
[31m+       class="space-y-4"[90m
[31m+     >[90m
[31m+       <div[90m
[31m+         class="space-y-2"[90m
[31m+       >[90m
[31m+         <label[90m
[31m+           class="text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"[90m
[31m+           for="_r_3_-form-item"[90m
[31m+         >[90m
[31m+           First Name[90m
[31m+         </label>[90m
[31m+         <input[90m
[31m+           aria-describedby="_r_3_-form-item-description"[90m
[31m+           aria-invalid="false"[90m
[31m+           class="flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm"[90m
[31m+           id="_r_3_-form-item"[90m
[31m+           name="firstName"[90m
[31m+           placeholder="John"[90m
[31m+           value="John"[90m
[31m+         />[90m
[31m+       </div>[90m
[31m+       <div[90m
[31m+         class="space-y-2"[90m
[31m+       >[90m
[31m+         <label[90m
[31m+           class="text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"[90m
[31m+           for="_r_4_-form-item"[90m
[31m+         >[90m
[31m+           Last Name[90m
[31m+         </label>[90m
[31m+         <input[90m
[31m+           aria-describedby="_r_4_-form-item-description"[90m
[31m+           aria-invalid="false"[90m
[31m+           class="flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm"[90m
[31m+           id="_r_4_-form-item"[90m
[31m+           name="lastName"[90m
[31m+           placeholder="Doe"[90m
[31m+           value="Doe"[90m
[31m+         />[90m
[31m+       </div>[90m
[31m+       <div[90m
[31m+         class="space-y-2"[90m
[31m+       >[90m
[31m+         <label[90m
[31m+           class="text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"[90m
[31m+           for="_r_5_-form-item"[90m
[31m+         >[90m
[31m+           Email[90m
[31m+         </label>[90m
[31m+         <input[90m
[31m+           aria-describedby="_r_5_-form-item-description"[90m
[31m+           aria-invalid="false"[90m
[31m+           class="flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm"[90m
[31m+           id="_r_5_-form-item"[90m
[31m+           name="email"[90m
[31m+           placeholder="john@example.com"[90m
[31m+           value="john@example.com"[90m
[31m+         />[90m
[31m+       </div>[90m
[31m+       <button[90m
[31m+         class="inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 hover-elevate active-elevate-2 bg-primary text-primary-foreground border border-primary-border min-h-9 px-4 py-2"[90m
[31m+         type="submit"[90m
[31m+       >[90m
[31m+         Save Member[90m
[31m+       </button>[90m
[31m+     </form>,[90m
[31m+     "timeStamp": 1768464653709,[90m
[31m+     "type": "submit",[90m
[31m+   },[90m
[2m  ][22m
[39m[90m

Number of calls: [1m1[22m
[39m

Ignored nodes: comments, script, style
[36m<html>[39m
  [36m<head />[39m
  [36m<body>[39m
    [36m<div>[39m
      [36m<form[39m
        [33mclass[39m=[32m"space-y-4"[39m
      [36m>[39m
        [36m<div[39m
          [33mclass[39m=[32m"space-y-2"[39m
        [36m>[39m
          [36m<label[39m
            [33mclass[39m=[32m"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"[39m
            [33mfor[39m=[32m"_r_3_-form-item"[39m
          [36m>[39m
            [0mFirst Name[0m
          [36m</label>[39m
          [36m<input[39m
            [33maria-describedby[39m=[32m"_r_3_-form-item-description"[39m
            [33maria-invalid[39m=[32m"false"[39m
            [33mclass[39m=[32m"flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm"[39m
            [33mid[39m=[32m"_r_3_-form-item"[39m
            [33mname[39m=[32m"firstName"[39m
            [33mplaceholder[39m=[32m"John"[39m
            [33mvalue[39m=[32m"John"[39m
          [36m/>[39m
        [36m</div>[39m
        [36m<div[39m
          [33mclass[39m=[32m"space-y-2"[39m
        [36m>[39m
          [36m<label[39m
            [33mclass[39m=[32m"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"[39m
            [33mfor[39m=[32m"_r_4_-form-item"[39m
          [36m>[39m
            [0mLast Name[0m
          [36m</label>[39m
          [36m<input[39m
            [33maria-describedby[39m=[32m"_r_4_-form-item-description"[39m
            [33maria-invalid[39m=[32m"false"[39m
            [33mclass[39m=[32m"flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm"[39m
            [33mid[39m=[32m"_r_4_-form-item"[39m
            [33mname[39m=[32m"lastName"[39m
            [33mplaceholder[39m=[32m"Doe"[39m
            [33mvalue[39m=[32m"Doe"[39m
          [36m/>[39m
        [36m</div>[39m
        [36m<div[39m
          [33mclass[39m=[32m"space-y-2"[39m
        [36m>[39m
          [36m<label[39m
            [33mclass[39m=[32m"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"[39m
            [33mfor[39m=[32m"_r_5_-form-item"[39m
          [36m>[39m
            [0mEmail[0m
          [36m</label>[39m
          [36m<input[39m
            [33maria-describedby[39m=[32m"_r_5_-form-item-description"[39m
            [33maria-invalid[39m=[32m"false"[39m
            [33mclass[39m=[32m"flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm"[39m
            [33mid[39m=[32m"_r_5_-form-item"[39m
            [33mname[39m=[32m"email"[39m
            [33mplaceholder[39m=[32m"john@example.com"[39m
            [33mvalue[39m=[32m"john@example.com"[39m
          [36m/>[39m
        [36m</div>[39m
        [36m<button[39m
          [33mclass[39m=[32m"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 hover-elevate active-elevate-2 bg-primary text-primary-foreground border border-primary-border min-h-9 px-4 py-2"[39m
          [33mtype[39m=[32m"submit"[39m
        [36m>[39m
          [0mSave Member[0m
        [36m</button>[39m
      [36m</form>[39m
    [36m</div>[39m
  [36m</body>[39m
[36m</html>[39m
[36m [2m‚ùØ[22m tests/integration/components/member-form.test.tsx:[2m32:30[22m[39m
    [90m 30| [39m
    [90m 31| [39m        [35mawait[39m [34mwaitFor[39m(() [33m=>[39m {
    [90m 32| [39m            [34mexpect[39m(onSubmit)[33m.[39m[34mtoHaveBeenCalledWith[39m({
    [90m   | [39m                             [31m^[39m
    [90m 33| [39m                firstName[33m:[39m [32m'John'[39m[33m,[39m
    [90m 34| [39m                lastName[33m:[39m [32m'Doe'[39m[33m,[39m
[90m [2m‚ùØ[22m runWithExpensiveErrorDiagnosticsDisabled node_modules/@testing-library/dom/dist/config.js:[2m47:12[22m[39m
[90m [2m‚ùØ[22m checkCallback node_modules/@testing-library/dom/dist/wait-for.js:[2m124:77[22m[39m
[90m [2m‚ùØ[22m Timeout.checkRealTimersCallback node_modules/@testing-library/dom/dist/wait-for.js:[2m118:16[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[1/1]‚éØ[22m[39m


[2m Test Files [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m14 passed[39m[22m[90m (15)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m110 passed[39m[22m[90m (111)[39m
[2m   Start at [22m 19:10:37
[2m   Duration [22m 60.10s[2m (transform 20.31s, setup 6.62s, import 34.13s, tests 5.33s, environment 57.64s)[22m

